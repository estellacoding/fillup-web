# 設計文件

## 概述

快速記錄功能是 FillUp! 應用程式的核心互動介面，專為最小化使用者記錄飲水的摩擦而設計。該功能採用分層式介面設計，優先顯示最常用的操作，同時提供進階功能的便捷存取。設計重點在於速度、直覺性和即時回饋。

## 架構

### 系統架構
```
快速記錄介面
├── 預設按鈕層 (主要互動)
├── 自訂輸入層 (次要互動)  
├── 歷史記錄層 (快速重複)
└── 回饋系統層 (確認與進度)
```

### 資料流
```
使用者輸入 → 驗證 → 記錄儲存 → 進度更新 → 視覺回饋 → 歷史更新
```

## 元件與介面

### 1. 主要記錄介面 (QuickLoggingInterface)

**佈局結構：**
- 垂直堆疊設計，適合單手操作
- 預設按鈕佔據螢幕上半部 60%
- 自訂輸入和歷史記錄共享下半部 40%

**預設按鈕設計：**
```
[  250ml  ] [  350ml  ] [  500ml  ]
   大按鈕     中按鈕     大按鈕
  (最常用)   (標準)    (運動用)
```

**視覺規格：**
- 按鈕最小尺寸：88x88px (雙倍無障礙標準)
- 間距：16px 按鈕間距，24px 區塊間距
- 圓角：12px 現代化外觀
- 陰影：輕微陰影增加深度感

### 2. 自訂輸入介面 (CustomInputInterface)

**數字鍵盤設計：**
```
[7] [8] [9]
[4] [5] [6] 
[1] [2] [3]
[⌫] [0] [✓]
```

**輸入驗證：**
- 即時驗證：輸入時顯示範圍提示
- 錯誤狀態：紅色邊框 + 震動回饋
- 成功狀態：綠色邊框 + 確認按鈕啟用

**互動流程：**
1. 點擊「自訂」按鈕 → 滑入數字鍵盤
2. 輸入數值 → 即時驗證與預覽
3. 點擊確認 → 滑出鍵盤 + 記錄

### 3. 歷史記錄面板 (HistoryPanel)

**記錄項目設計：**
```
[容量] [時間]     [重複按鈕]
350ml  14:30        [+]
250ml  12:15        [+]
500ml  10:00        [+]
```

**顯示邏輯：**
- 最多顯示 5 個最近記錄
- 按時間倒序排列
- 相同容量合併顯示頻率
- 滑動手勢支援刪除

### 4. 回饋系統 (FeedbackSystem)

**成功動畫：**
- 水滴動畫：從按鈕位置落入進度條
- 進度條填充：平滑動畫 300ms
- 數字跳動：計數器動畫顯示新總量

**音效設計：**
- 成功音效：輕快的水滴聲 (可選)
- 錯誤音效：輕柔的提示音
- 慶祝音效：達標時的鈴聲

**觸覺回饋：**
- 輕觸回饋：按鈕按下時
- 成功回饋：記錄成功時
- 錯誤回饋：輸入錯誤時

## 資料模型

### WaterEntry (飲水記錄)
```typescript
interface WaterEntry {
  id: string;
  volume: number;        // 容量 (ml)
  timestamp: Date;       // 記錄時間
  source: 'preset' | 'custom' | 'history'; // 記錄來源
  presetType?: '250' | '350' | '500';      // 預設按鈕類型
}
```

### DailyProgress (每日進度)
```typescript
interface DailyProgress {
  date: string;          // YYYY-MM-DD
  target: number;        // 目標容量 (ml)
  current: number;       // 當前容量 (ml)
  entries: WaterEntry[]; // 當日記錄
  percentage: number;    // 完成百分比
}
```

### UserPreferences (使用者偏好)
```typescript
interface UserPreferences {
  soundEnabled: boolean;     // 音效開關
  hapticEnabled: boolean;    // 觸覺回饋開關
  customVolumes: number[];   // 常用自訂容量
  defaultTarget: number;     // 預設每日目標
}
```

## 錯誤處理

### 輸入驗證錯誤
- **容量超出範圍：** 顯示「請輸入 1-10000ml 之間的數值」
- **無效輸入：** 自動過濾非數字字元
- **空值提交：** 禁用確認按鈕直到有效輸入

### 系統錯誤
- **儲存失敗：** 顯示重試選項，本地暫存資料
- **網路錯誤：** 離線模式，稍後同步
- **資料損壞：** 重置為預設值，通知使用者

### 使用者體驗錯誤
- **誤觸防護：** 大容量記錄需二次確認
- **快速連擊：** 防止重複記錄，顯示冷卻時間
- **意外退出：** 自動儲存草稿狀態

## 測試策略

### 單元測試
- **資料驗證：** 容量範圍、格式驗證
- **計算邏輯：** 進度計算、百分比計算
- **狀態管理：** 歷史記錄更新、偏好設定

### 整合測試
- **資料流：** 輸入 → 驗證 → 儲存 → 更新
- **介面互動：** 按鈕點擊、動畫觸發
- **跨元件通訊：** 記錄更新、進度同步

### 使用者體驗測試
- **速度測試：** 3 秒內完成記錄
- **無障礙測試：** 螢幕閱讀器、鍵盤導航
- **裝置測試：** 不同螢幕尺寸、作業系統

### 效能測試
- **動畫效能：** 60fps 流暢度
- **記憶體使用：** 歷史記錄管理
- **電池影響：** 背景處理最小化

## 技術考量

### 響應式設計
- **斷點：** 320px (小型手機) 到 768px (平板)
- **字體縮放：** 支援系統字體大小設定
- **觸控目標：** 最小 44px，建議 88px

### 效能最佳化
- **懶載入：** 歷史記錄按需載入
- **虛擬化：** 大量歷史資料虛擬滾動
- **快取策略：** 常用資料記憶體快取

### 無障礙支援
- **語義標籤：** 適當的 ARIA 標籤
- **鍵盤導航：** Tab 順序邏輯
- **螢幕閱讀器：** 狀態變化通知

### 國際化
- **多語言：** 繁體中文、簡體中文、英文
- **數字格式：** 本地化數字顯示
- **時間格式：** 12/24 小時制支援