# 設計文件

## 概述

快速記錄功能是 FillUp! 應用程式的核心互動介面，專為最小化使用者記錄飲水的摩擦而設計。該功能採用分層式介面設計，優先顯示最常用的操作，同時提供進階功能的便捷存取。設計重點在於速度、直覺性和即時回饋。

## 資料流
```
使用者輸入 → 驗證 → 記錄儲存 → 進度更新 → 視覺回饋 → 歷史更新
```

## 元件與介面

### 1. 主要記錄介面 (QuickLoggingInterface)

**佈局結構：**
- 垂直堆疊設計，適合單手操作
- 預設按鈕佔據螢幕上半部 60%
- 自訂輸入和歷史記錄共享下半部 40%

**預設按鈕設計：**
```
[  250ml  ] [  350ml  ] [  500ml  ]
   大按鈕     中按鈕     大按鈕
  (最常用)   (標準)    (運動用)
```

**視覺規格：**
- 按鈕最小尺寸：88x88px (雙倍無障礙標準，滿足需求 1.5)
- 間距：16px 按鈕間距，24px 區塊間距
- 圓角：12px 現代化外觀
- 陰影：輕微陰影增加深度感
- 單手操作優化：按鈕配置在拇指可達範圍內

**效能要求：**
- 按鈕回應時間：< 100ms (觸覺回饋)
- 記錄處理時間：< 1 秒 (滿足需求 1.2)
- 動畫顯示時間：< 0.5 秒 (滿足需求 1.3)
- 完整流程時間：< 3 秒 (滿足需求 1.4)

### 2. 自訂輸入介面 (CustomInputInterface)

**數字鍵盤設計：**
```
[7] [8] [9]
[4] [5] [6] 
[1] [2] [3]
[⌫] [0] [✓]
```

**輸入驗證：**
- 即時驗證：輸入時顯示範圍提示 (1-10000ml，滿足需求 2.2)
- 錯誤狀態：紅色邊框 + 震動回饋 + 錯誤訊息 (滿足需求 2.3)
- 成功狀態：綠色邊框 + 確認按鈕啟用
- 輸入限制：自動過濾非數字字元，防止無效輸入

**快速確認機制：**
- 大型確認按鈕：易於點擊的 ✓ 按鈕
- 鍵盤快捷鍵：Enter 鍵快速確認
- 視覺預覽：顯示即將記錄的容量 (滿足需求 2.4)

**互動流程：**
1. 點擊「自訂」按鈕 → 滑入數字鍵盤
2. 輸入數值 → 即時驗證與預覽
3. 點擊確認 → 滑出鍵盤 + 記錄

### 3. 歷史記錄面板 (HistoryPanel)

**記錄項目設計：**
```
[容量] [時間]     [重複按鈕]
350ml  14:30        [+]
250ml  12:15        [+]
500ml  10:00        [+]
```

**顯示邏輯：**
- 最多顯示 5 個最近記錄 (滿足需求 3.1)
- 按時間倒序排列，最新記錄在頂部
- 顯示容量和時間戳 (滿足需求 3.2)
- 相同容量合併顯示頻率
- 滑動手勢支援刪除

**互動設計：**
- 一鍵重複：點擊歷史項目立即記錄 (滿足需求 3.3)
- 即時更新：新記錄後立即刷新歷史 (滿足需求 3.4)
- 持久化儲存：使用 localStorage 保存歷史 (滿足需求 3.5)
- 視覺回饋：點擊時短暫高亮顯示

### 4. 回饋系統 (FeedbackSystem)

**成功動畫：**
- 水滴動畫：從按鈕位置落入進度條 (滿足需求 4.1)
- 進度條填充：平滑動畫 300ms，< 1 秒完成 (滿足需求 4.2)
- 數字跳動：計數器動畫顯示新總量
- 慶祝動畫：達到每日目標時的特殊動畫 (滿足需求 4.5)

**音效設計：**
- 成功音效：輕快的水滴聲 (可選，滿足需求 4.3)
- 錯誤音效：輕柔的提示音
- 慶祝音效：達標時的鈴聲
- 音效控制：使用者可在偏好設定中開關

**觸覺回饋：**
- 輕觸回饋：按鈕按下時
- 成功回饋：記錄成功時
- 錯誤回饋：輸入錯誤時

**確認訊息系統：**
- 顯示內容：記錄的容量 + 更新後的每日總量 (滿足需求 4.4)
- 顯示時間：2-3 秒後自動消失
- 位置：螢幕頂部或進度條附近
- 樣式：簡潔的卡片設計，不干擾主要介面

## 資料模型

### WaterEntry (飲水記錄)
```typescript
interface WaterEntry {
  id: string;
  volume: number;        // 容量 (ml)
  timestamp: Date;       // 記錄時間
  source: 'preset' | 'custom' | 'history'; // 記錄來源
  presetType?: '250' | '350' | '500';      // 預設按鈕類型
}
```

### DailyProgress (每日進度)
```typescript
interface DailyProgress {
  date: string;          // YYYY-MM-DD
  target: number;        // 目標容量 (ml)
  current: number;       // 當前容量 (ml)
  entries: WaterEntry[]; // 當日記錄
  percentage: number;    // 完成百分比
}
```

### UserPreferences (使用者偏好)
```typescript
interface UserPreferences {
  soundEnabled: boolean;     // 音效開關
  hapticEnabled: boolean;    // 觸覺回饋開關
  customVolumes: number[];   // 常用自訂容量
  defaultTarget: number;     // 預設每日目標
}
```

## 錯誤處理

### 輸入驗證錯誤
- **容量超出範圍：** 顯示「請輸入 1-10000ml 之間的數值」(滿足需求 2.2, 2.3)
- **無效輸入：** 自動過濾非數字字元，即時提示
- **空值提交：** 禁用確認按鈕直到有效輸入 (滿足需求 2.3)
- **錯誤視覺回饋：** 紅色邊框、震動、錯誤圖示

### 系統錯誤
- **儲存失敗：** 顯示重試選項，本地暫存資料
- **網路錯誤：** 離線模式，稍後同步
- **資料損壞：** 重置為預設值，通知使用者

### 使用者體驗錯誤
- **誤觸防護：** 大容量記錄需二次確認
- **快速連擊：** 防止重複記錄，顯示冷卻時間
- **意外退出：** 自動儲存草稿狀態

## 測試策略

### 單元測試
- **資料驗證：** 容量範圍、格式驗證
- **計算邏輯：** 進度計算、百分比計算
- **狀態管理：** 歷史記錄更新、偏好設定

### 整合測試
- **資料流：** 輸入 → 驗證 → 儲存 → 更新
- **介面互動：** 按鈕點擊、動畫觸發
- **跨元件通訊：** 記錄更新、進度同步

### 使用者體驗測試
- **速度測試：** 3 秒內完成記錄
- **無障礙測試：** 螢幕閱讀器、鍵盤導航
- **裝置測試：** 不同螢幕尺寸、作業系統

### 效能測試
- **動畫效能：** 60fps 流暢度
- **記憶體使用：** 歷史記錄管理
- **電池影響：** 背景處理最小化
- **回應時間測試：** 驗證 3 秒完成記錄的需求 (需求 1.4)
- **動畫時間測試：** 驗證 0.5 秒內顯示成功動畫 (需求 1.3)
- **處理時間測試：** 驗證 1 秒內完成記錄處理 (需求 1.2, 4.2)

## 設計決策與理由

### 1. 分層式介面設計
**決策：** 採用垂直分層的介面架構，預設按鈕佔主要空間
**理由：** 
- 符合 80/20 法則，大部分使用者使用標準容量
- 減少認知負荷，優先顯示最常用功能
- 支援單手操作的人體工學設計

### 2. 三個預設按鈕容量選擇
**決策：** 選擇 250ml、350ml、500ml 作為預設容量
**理由：**
- 250ml：標準水杯容量，日常最常用
- 350ml：標準瓶裝水容量，便利商店常見
- 500ml：運動水瓶容量，健身和運動場景

### 3. 1-10000ml 容量範圍
**決策：** 設定相對寬鬆的容量範圍
**理由：**
- 涵蓋從小口飲水到大容量水瓶的所有場景
- 避免過度限制使用者的真實需求
- 10000ml 上限防止明顯的輸入錯誤

### 4. 5 個歷史記錄限制
**決策：** 歷史面板只顯示最近 5 筆記錄
**理由：**
- 平衡功能性與介面簡潔性
- 5 個項目符合短期記憶容量
- 減少介面複雜度，提升載入效能

### 5. 即時回饋與動畫設計
**決策：** 每次記錄都提供豐富的視覺和觸覺回饋
**理由：**
- 增強使用者的成就感和參與度
- 確認操作成功，減少使用者疑慮
- 支援遊戲化體驗，提升長期使用動機

## 技術考量

### 響應式設計
- **斷點：** 320px (小型手機) 到 768px (平板)
- **字體縮放：** 支援系統字體大小設定
- **觸控目標：** 最小 44px，建議 88px

### 效能最佳化
- **懶載入：** 歷史記錄按需載入
- **虛擬化：** 大量歷史資料虛擬滾動
- **快取策略：** 常用資料記憶體快取

### 國際化
- **多語言：** 繁體中文、簡體中文、英文
- **數字格式：** 本地化數字顯示
- **時間格式：** 12/24 小時制支援